<body style="background-color: darkblue; color:white;">
    <style>
        body {
            line-height: 20px
        }

        #published {
            max-width: 40em;
            white-space: pre-wrap;
        }

        .old {
            max-width: 50em;
            white-space: pre-wrap;
            opacity: 0.5;
        }

        .flexrow {
            display: flex;
        }

        .debug {
            display: none;
        }

        .showdebug {
            display: block;
            opacity: 0.5;
        }
    </style>
    <div class="flexrow">
        <pre id="published" onclick="toggleDebug(event)">
        </pre>
        <pre class="old"><div class="showdebug">
        [
            {
                "name": "Rose",
                "beliefs": [],
                "goals": [
                    {
                        "verb": "exit",
                        "actor": "\\\\Rose",
                        "status": "untried",
                        "fullfilledBy": []
                    }
                ]
            },
            {
                "name": "Zafra",
                "beliefs": [
                    {
                        "property": "isLocked",
                        "ofDesireable": {
                            "name": "door",
                            "isLocked": true
                        },
                        "shouldBe": "=",
                        "toValue": true
                    }
                ],
                "goals": []
            }
        ]</div><div class="showdebug">1 initial scenes</div><div class="showdebug">TURN 1</div><div>Rose wanted to escape the confines of her birth.</div><div>Rose could try unlocking the door with before untried exiting.</div><div>DONE: Rose partly successful exit.</div><div>Rose could try unlocking the door with</div><div>  Q: What is Rose trying to do now?</div><div>  A: Rose untried unlock the door with</div><div>same scene, now Rose untried unlock the door with</div><div>DONE: Rose successful unlock the door with.</div><div>((But Zafra  won't like  Rose unlock the door with .))</div><div>  Q: What is Rose trying to do now?</div><div>  A: Rose partly successful exit</div><div>same scene, now Rose partly successful exit</div><div>DONE: Rose successful exit.</div><div>
           * * *    
        
        </div><div class="showdebug">END TURN 1</div><div class="showdebug">[
            {
                "name": "Rose",
                "beliefs": [],
                "goals": [
                    {
                        "verb": "exit",
                        "actor": "\\\\Rose",
                        "status": "successful",
                        "fullfilledBy": [
                            {
                                "verb": "unlock _ with",
                                "actor": "\\\\Rose",
                                "noun": {
                                    "name": "door",
                                    "isLocked": false
                                },
                                "status": "successful",
                                "fulfills": "\\\\..",
                                "fullfilledBy": []
                            }
                        ]
                    }
                ]
            },
            {
                "name": "Zafra",
                "beliefs": [
                    {
                        "property": "isLocked",
                        "ofDesireable": {
                            "name": "door",
                            "isLocked": false
                        },
                        "shouldBe": "=",
                        "toValue": true
                    }
                ],
                "goals": []
            }
        ]</div><div class="showdebug">TURN 2</div><div>Zafra arrives to receive news of Rose unlocking the door with, but the isLocked of the door should remain true.</div><div>" Rose successful unlock the door with  is bad news."</div><div>Zafra could try locking the door with before untried receiveing news of Rose unlocking the door with, but the isLocked of the door should remain true.</div><div>DONE: Zafra partly successful receive news of Rose unlocking the door with, but the isLocked of the door should remain true.</div><div>Zafra could try locking the door with</div><div>  Q: What is Zafra trying to do now?</div><div>  A: Zafra untried lock the door with</div><div>same scene, now Zafra untried lock the door with</div><div>DONE: Zafra failed lock the door with.</div><div>  Q: What is Zafra trying to do now?</div><div>  A: nothing</div><div>same scene, now nothing</div><div>STUCK: Zafra partly successful receive news of Rose unlocking the door with, but the isLocked of the door should remain true</div><div>Zafra could try searching for solutions to Zafra receiveing news of Rose unlocking the door with, but the isLocked of the door should remain true before nothing.</div><div>
           * * *    
        
        </div><div class="showdebug">END TURN 2</div><div class="showdebug">[
            {
                "name": "Rose",
                "beliefs": [],
                "goals": [
                    {
                        "verb": "exit",
                        "actor": "\\\\Rose",
                        "status": "successful",
                        "fullfilledBy": [
                            {
                                "verb": "unlock _ with",
                                "actor": "\\\\Rose",
                                "noun": {
                                    "name": "door",
                                    "isLocked": false
                                },
                                "status": "successful",
                                "fulfills": "\\\\..",
                                "fullfilledBy": []
                            }
                        ]
                    }
                ]
            },
            {
                "name": "Zafra",
                "beliefs": [
                    {
                        "property": "isLocked",
                        "ofDesireable": {
                            "name": "door",
                            "isLocked": false
                        },
                        "shouldBe": "=",
                        "toValue": true
                    }
                ],
                "goals": [
                    {
                        "verb": "search for solutions to _",
                        "actor": "\\\\Zafra",
                        "noun": {
                            "verb": "receive news of _, but _",
                            "actor": "\\\\Zafra",
                            "noun": {
                                "verb": "unlock _ with",
                                "actor": "\\\\Rose",
                                "noun": {
                                    "name": "door",
                                    "isLocked": false
                                },
                                "status": "successful",
                                "fulfills": "\\\\..",
                                "fullfilledBy": [],
                                "level": "successful"
                            },
                            "secondNoun": {
                                "property": "isLocked",
                                "ofDesireable": {
                                    "name": "door",
                                    "isLocked": false
                                },
                                "shouldBe": "=",
                                "toValue": true
                            },
                            "status": "partly successful",
                            "fullfilledBy": [
                                {
                                    "verb": "lock _ with",
                                    "actor": "\\\\Zafra",
                                    "noun": {
                                        "name": "door",
                                        "isLocked": false
                                    },
                                    "status": "failed",
                                    "fulfills": "\\\\..",
                                    "fullfilledBy": []
                                }
                            ]
                        },
                        "status": "untried",
                        "fullfilledBy": []
                    }
                ]
            }
        ]</div><div class="showdebug">TURN 3</div><div>Rose arrives to reflect upon attempting Rose exiting.</div><div>Rose reflected.</div><div>DONE: Rose successful reflect upon attempting Rose exiting.</div><div>
           * * *    
        
        </div><div class="showdebug">END TURN 3</div><div class="showdebug">[
            {
                "name": "Rose",
                "beliefs": [],
                "goals": [
                    {
                        "verb": "exit",
                        "actor": "\\\\Rose",
                        "status": "successful",
                        "fullfilledBy": [
                            {
                                "verb": "unlock _ with",
                                "actor": "\\\\Rose",
                                "noun": {
                                    "name": "door",
                                    "isLocked": false
                                },
                                "status": "successful",
                                "fulfills": "\\\\..",
                                "fullfilledBy": []
                            }
                        ]
                    }
                ]
            },
            {
                "name": "Zafra",
                "beliefs": [
                    {
                        "property": "isLocked",
                        "ofDesireable": {
                            "name": "door",
                            "isLocked": false
                        },
                        "shouldBe": "=",
                        "toValue": true
                    }
                ],
                "goals": [
                    {
                        "verb": "search for solutions to _",
                        "actor": "\\\\Zafra",
                        "noun": {
                            "verb": "receive news of _, but _",
                            "actor": "\\\\Zafra",
                            "noun": {
                                "verb": "unlock _ with",
                                "actor": "\\\\Rose",
                                "noun": {
                                    "name": "door",
                                    "isLocked": false
                                },
                                "status": "successful",
                                "fulfills": "\\\\..",
                                "fullfilledBy": [],
                                "level": "successful"
                            },
                            "secondNoun": {
                                "property": "isLocked",
                                "ofDesireable": {
                                    "name": "door",
                                    "isLocked": false
                                },
                                "shouldBe": "=",
                                "toValue": true
                            },
                            "status": "partly successful",
                            "fullfilledBy": [
                                {
                                    "verb": "lock _ with",
                                    "actor": "\\\\Zafra",
                                    "noun": {
                                        "name": "door",
                                        "isLocked": false
                                    },
                                    "status": "failed",
                                    "fulfills": "\\\\..",
                                    "fullfilledBy": []
                                }
                            ]
                        },
                        "status": "untried",
                        "fullfilledBy": []
                    }
                ]
            }
        ]</div><div>THE END</div><div class="showdebug">[
            {
                "choice": {
                    "choice": "ally",
                    "scene": {
                        "pulse": {
                            "verb": "exit",
                            "actor": "\\\\Rose",
                            "status": "successful",
                            "fullfilledBy": [
                                {
                                    "verb": "unlock _ with",
                                    "actor": "\\\\Rose",
                                    "noun": {
                                        "name": "door",
                                        "isLocked": false
                                    },
                                    "status": "successful",
                                    "fulfills": "\\\\..",
                                    "fullfilledBy": []
                                }
                            ]
                        },
                        "actor": "\\\\Rose",
                        "result": "success",
                        "isFinished": true
                    }
                },
                "consequences": [
                    {
                        "scene": {
                            "pulse": {
                                "verb": "receive news of _, but _",
                                "actor": "\\\\Zafra",
                                "noun": {
                                    "verb": "unlock _ with",
                                    "actor": "\\\\Rose",
                                    "noun": {
                                        "name": "door",
                                        "isLocked": false
                                    },
                                    "status": "successful",
                                    "fulfills": "\\\\..",
                                    "fullfilledBy": [],
                                    "level": "successful"
                                },
                                "secondNoun": {
                                    "property": "isLocked",
                                    "ofDesireable": {
                                        "name": "door",
                                        "isLocked": false
                                    },
                                    "shouldBe": "=",
                                    "toValue": true
                                },
                                "status": "partly successful",
                                "fullfilledBy": [
                                    {
                                        "verb": "lock _ with",
                                        "actor": "\\\\Zafra",
                                        "noun": {
                                            "name": "door",
                                            "isLocked": false
                                        },
                                        "status": "failed",
                                        "fulfills": "\\\\..",
                                        "fullfilledBy": []
                                    }
                                ]
                            },
                            "actor": "\\\\Zafra",
                            "result": {
                                "verb": "search for solutions to _",
                                "actor": "\\\\Zafra",
                                "noun": {
                                    "verb": "receive news of _, but _",
                                    "actor": "\\\\Zafra",
                                    "noun": {
                                        "verb": "unlock _ with",
                                        "actor": "\\\\Rose",
                                        "noun": {
                                            "name": "door",
                                            "isLocked": false
                                        },
                                        "status": "successful",
                                        "fulfills": "\\\\..",
                                        "fullfilledBy": [],
                                        "level": "successful"
                                    },
                                    "secondNoun": {
                                        "property": "isLocked",
                                        "ofDesireable": {
                                            "name": "door",
                                            "isLocked": false
                                        },
                                        "shouldBe": "=",
                                        "toValue": true
                                    },
                                    "status": "partly successful",
                                    "fullfilledBy": [
                                        {
                                            "verb": "lock _ with",
                                            "actor": "\\\\Zafra",
                                            "noun": {
                                                "name": "door",
                                                "isLocked": false
                                            },
                                            "status": "failed",
                                            "fulfills": "\\\\..",
                                            "fullfilledBy": []
                                        }
                                    ]
                                },
                                "status": "untried",
                                "fullfilledBy": []
                            },
                            "isFinished": true
                        },
                        "foreshadow": {
                            "character": {
                                "name": "Zafra",
                                "beliefs": [
                                    {
                                        "property": "isLocked",
                                        "ofDesireable": {
                                            "name": "door",
                                            "isLocked": false
                                        },
                                        "shouldBe": "=",
                                        "toValue": true
                                    }
                                ],
                                "goals": [
                                    {
                                        "verb": "search for solutions to _",
                                        "actor": "\\\\Zafra",
                                        "noun": {
                                            "verb": "receive news of _, but _",
                                            "actor": "\\\\Zafra",
                                            "noun": {
                                                "verb": "unlock _ with",
                                                "actor": "\\\\Rose",
                                                "noun": {
                                                    "name": "door",
                                                    "isLocked": false
                                                },
                                                "status": "successful",
                                                "fulfills": "\\\\..",
                                                "fullfilledBy": [],
                                                "level": "successful"
                                            },
                                            "secondNoun": {
                                                "property": "isLocked",
                                                "ofDesireable": {
                                                    "name": "door",
                                                    "isLocked": false
                                                },
                                                "shouldBe": "=",
                                                "toValue": true
                                            },
                                            "status": "partly successful",
                                            "fullfilledBy": [
                                                {
                                                    "verb": "lock _ with",
                                                    "actor": "\\\\Zafra",
                                                    "noun": {
                                                        "name": "door",
                                                        "isLocked": false
                                                    },
                                                    "status": "failed",
                                                    "fulfills": "\\\\..",
                                                    "fullfilledBy": []
                                                }
                                            ]
                                        },
                                        "status": "untried",
                                        "fullfilledBy": []
                                    }
                                ]
                            },
                            "belief": {
                                "property": "isLocked",
                                "ofDesireable": {
                                    "name": "door",
                                    "isLocked": false
                                },
                                "shouldBe": "=",
                                "toValue": true
                            },
                            "news": {
                                "verb": "unlock _ with",
                                "actor": "\\\\Rose",
                                "noun": {
                                    "name": "door",
                                    "isLocked": false
                                },
                                "status": "successful",
                                "fulfills": "\\\\..",
                                "fullfilledBy": [],
                                "level": "successful"
                            }
                        }
                    }
                ],
                "closure": {
                    "scene": {
                        "pulse": {
                            "verb": "reflect upon attempting _",
                            "actor": "\\\\Rose",
                            "noun": {
                                "verb": "exit",
                                "actor": "\\\\Rose",
                                "status": "successful",
                                "fullfilledBy": [
                                    {
                                        "verb": "unlock _ with",
                                        "actor": "\\\\Rose",
                                        "noun": {
                                            "name": "door",
                                            "isLocked": false
                                        },
                                        "status": "successful",
                                        "fulfills": "\\\\..",
                                        "fullfilledBy": []
                                    }
                                ]
                            },
                            "status": "successful",
                            "fulfills": "\\\\..",
                            "fullfilledBy": []
                        },
                        "actor": "\\\\Rose",
                        "result": "success",
                        "isFinished": true
                    }
                }
            }
        ]</div> 
</pre>
        <pre id="diff"></pre>
    </div>
    <script>
        let debugMode = false;
        function toggleDebug(e) {
            if (debugMode)
                document.querySelectorAll(".debug").forEach(el => el.className = 'showdebug');
            else
                document.querySelectorAll(".showdebug").forEach(el => el.className = 'debug');
            debugMode = !debugMode;
            e.target.scrollIntoViewIfNeeded();
        }
        toggleDebug();
        toggleDebug();
    </script>
    <script src="./build.js"></script>

</body>